var uniformDraw = function (xs) {
  return xs[randomInteger(xs.length)];
};

var mean = function(thunk){
  return expectation(Enumerate(thunk), function(v){return v;});
};

var negate = function(predicate){
  return function(x){
    return !predicate(x);
  };
};

var identity = function(x){
  return x;
};

var condition = function(x){
 factor(x ? 0 : -Infinity);
};

var foreach = function(lst, fn) {
  var foreach_ = function(i) {
    if (i < lst.length) {
      fn(lst[i]);
      foreach_(i + 1);
    }
  };
  foreach_(0);
};

var getUtterancesOneFeature = function(context) {
  var utts = [];
  // map takes array context and with each element in context does what is in function
  map(function(c) {
    // utterance with adjective and noun
    utts.push(c[0]+"_"+c[1]);
    // utterance only with noun
    utts.push(c[1]);
    // utterance only with adjective
    utts.push(c[0]);
  },context);
  // returns list of strings with all possible utterances
  return _.unique(utts);
};

 var getTailoredTypicalityUnlogged = function(utt, object) {
    // console.log(utt);
    // console.log(object);
    // var f = Number.NEGATIVE_INFINITY;
    // var e = -1;//0.00015;
    // var f = -1;//0.00015;
    var tailoredtypicalities = {
      "apple" : {
        blue_apple : 0.462,
        green_apple : 0.961,
        red_apple : 0.953,
        black_avocado : 0.055,
        green_avocado : 0.022,
        red_avocado : 0.080,
        blue_banana : 0.044,
        brown_banana : 0.040,
        yellow_banana : 0.043,
        brown_carrot : 0.059,
        orange_carrot : 0.013,
        pink_carrot : 0.052,
        green_pear : 0.196,
        orange_pear : 0.142,
        yellow_pear : 0.140,
        black_pepper : 0.058,
        orange_pepper : 0.043,
        red_pepper : 0.027,
        green_pepper : 0.030,
        green_tomato : 0.102,
        pink_tomato : 0.022,
        red_tomato : 0.093
      },
      "avocado" : {
        blue_apple : 0.039,
        green_apple : 0.022,
        red_apple : 0.052,
        black_avocado : 0.812,
        green_avocado : 0.966,
        red_avocado : 0.696,
        blue_banana : 0.016,
        brown_banana : 0.048,
        yellow_banana : 0.024,
        brown_carrot : 0.053,
        orange_carrot : 0.034,
        pink_carrot : 0.061,
        green_pear : 0.055,
        orange_pear : 0.055,
        yellow_pear : 0.026,
        black_pepper : 0.046,
        orange_pepper : 0.045,
        red_pepper : 0.068,
        green_pepper : 0.015,
        green_tomato : 0.017,
        pink_tomato : 0.065,
        red_tomato : 0.023
      },
      "banana" : {
        blue_apple : 0.040,
        green_apple : 0.072,
        red_apple : 0.070,
        black_avocado : 0.036,
        green_avocado : 0.046,
        red_avocado : 0.070,
        blue_banana : 0.419,
        brown_banana : 0.657,
        yellow_banana : 0.979,
        brown_carrot : 0.076,
        orange_carrot : 0.079,
        pink_carrot : 0.021,
        green_pear : 0.021,
        orange_pear : 0.010,
        yellow_pear : 0.071,
        black_pepper : 0.069,
        orange_pepper : 0.011,
        red_pepper : 0.019,
        green_pepper : 0.026,
        green_tomato : 0.096,
        pink_tomato : 0.037,
        red_tomato : 0.013
      },
      "carrot" : {
        blue_apple : 0.035,
        green_apple : 0.023,
        red_apple : 0.011,
        black_avocado : 0.016,
        green_avocado : 0.060,
        red_avocado : 0.008,
        blue_banana : 0.039,
        brown_banana : 0.013,
        yellow_banana : 0.011,
        brown_carrot : 0.565,
        orange_carrot : 0.976,
        pink_carrot : 0.503,
        green_pear : 0.085,
        orange_pear : 0.052,
        yellow_pear : 0.016,
        black_pepper : 0.065,
        orange_pepper : 0.083,
        red_pepper : 0.036,
        green_pepper : 0.019,
        green_tomato : 0.013,
        pink_tomato : 0.056,
        red_tomato : 0.011
      },
      "pear" : {
        blue_apple : 0.004,
        green_apple : 0.140,
        red_apple : 0.014,
        black_avocado : 0.080,
        green_avocado : 0.045,
        red_avocado : 0.103,
        blue_banana : 0.012,
        brown_banana : 0.041,
        yellow_banana : 0.074,
        brown_carrot : 0.052,
        orange_carrot : 0.034,
        pink_carrot : 0.013,
        green_pear : 0.953,
        orange_pear : 0.686,
        yellow_pear : 0.924,
        black_pepper : 0.060,
        orange_pepper : 0.040,
        red_pepper : 0.077,
        green_pepper : 0.020,
        green_tomato : 0.045,
        pink_tomato : 0.011,
        red_tomato : 0.047
      },
      "pepper" : {
        blue_apple : 0.045,
        green_apple : 0.014,
        red_apple : 0.026,
        black_avocado : 0.080,
        green_avocado : 0.069,
        red_avocado : 0.104,
        blue_banana : 0.073,
        brown_banana : 0.060,
        yellow_banana : 0.070,
        brown_carrot : 0.086,
        orange_carrot : 0.043,
        pink_carrot : 0.049,
        green_pear : 0.016,
        orange_pear : 0.054,
        yellow_pear : 0.142,
        black_pepper : 0.637,
        orange_pepper : 0.841,
        red_pepper : 0.934,
        green_pepper : 0.941,
        green_tomato : 0.083,
        pink_tomato : 0.063,
        red_tomato : 0.049
      },
      "tomato" : {
        blue_apple : 0.034,
        green_apple : 0.044,
        red_apple : 0.088,
        black_avocado : 0.069,
        green_avocado : 0.052,
        red_avocado : 0.051,
        blue_banana : 0.042,
        brown_banana : 0.033,
        yellow_banana : 0.018,
        brown_carrot : 0.041,
        orange_carrot : 0.047,
        pink_carrot : 0.037,
        green_pear : 0.018,
        orange_pear : 0.022,
        yellow_pear : 0.023,
        black_pepper : 0.089,
        orange_pepper : 0.052,
        red_pepper : 0.018,
        green_pepper : 0.032,
        green_tomato : 0.738,
        pink_tomato : 0.412,
        red_tomato : 0.962
      },
      "fruit" : {
        blue_apple : 0.506,
        green_apple : 0.929,
        red_apple : 0.932,
        black_avocado : 0.539,
        green_avocado : 0.503,
        red_avocado : 0.329,
        blue_banana : 0.603,
        brown_banana : 0.726,
        yellow_banana : 0.973,
        brown_carrot : 0.092,
        orange_carrot : 0.019,
        pink_carrot : 0.051,
        green_pear : 0.937,
        orange_pear : 0.777,
        yellow_pear : 0.905,
        black_pepper : 0.182,
        orange_pepper : 0.194,
        red_pepper : 0.106,
        green_pepper : 0.183,
        green_tomato : 0.341,
        pink_tomato : 0.233,
        red_tomato : 0.413
      },
      "vegetable" : {
        blue_apple : 0.081,
        green_apple : 0.128,
        red_apple : 0.182,
        black_avocado : 0.332,
        green_avocado : 0.455,
        red_avocado : 0.236,
        blue_banana : 0.054,
        brown_banana : 0.077,
        yellow_banana : 0.055,
        brown_carrot : 0.623,
        orange_carrot : 0.895,
        pink_carrot : 0.401,
        green_pear : 0.115,
        orange_pear : 0.140,
        yellow_pear : 0.120,
        black_pepper : 0.531,
        orange_pepper : 0.777,
        red_pepper : 0.777,
        green_pepper : 0.824,
        green_tomato : 0.598,
        pink_tomato : 0.336,
        red_tomato : 0.745
      },
      "yellow" : {
        blue_apple : 0.078,
        green_apple : 0.187,
        red_apple : 0.011,
        black_avocado : 0.036,
        green_avocado : 0.053,
        red_avocado : 0.029,
        blue_banana : 0.058,
        brown_banana : 0.047,
        yellow_banana : 0.766,
        brown_carrot : 0.094,
        orange_carrot : 0.188,
        pink_carrot : 0.058,
        green_pear : 0.307,
        orange_pear : 0.121,
        yellow_pear : 0.703,
        black_pepper : 0.073,
        orange_pepper : 0.169,
        red_pepper : 0.049,
        green_pepper : 0.048,
        green_tomato : 0.058,
        pink_tomato : 0.031,
        red_tomato : 0.063
      },
      "orange" : {
        blue_apple : 0.022,
        green_apple : 0.027,
        red_apple : 0.085,
        black_avocado : 0.009,
        green_avocado : 0.028,
        red_avocado : 0.075,
        blue_banana : 0.093,
        brown_banana : 0.081,
        yellow_banana : 0.219,
        brown_carrot : 0.101,
        orange_carrot : 0.889,
        pink_carrot : 0.079,
        green_pear : 0.092,
        orange_pear : 0.831,
        yellow_pear : 0.341,
        black_pepper : 0.063,
        orange_pepper : 0.787,
        red_pepper : 0.276,
        green_pepper : 0.142,
        green_tomato : 0.064,
        pink_tomato : 0.106,
        red_tomato : 0.120
      },           
      "red" : {
        blue_apple : 0.060,
        green_apple : 0.088,
        red_apple : 0.762,
        black_avocado : 0.107,
        green_avocado : 0.018,
        red_avocado : 0.528,
        blue_banana : 0.057,
        brown_banana : 0.072,
        yellow_banana : 0.073,
        brown_carrot : 0.105,
        orange_carrot : 0.162,
        pink_carrot : 0.153,
        green_pear : 0.073,
        orange_pear : 0.156,
        yellow_pear : 0.057,
        black_pepper : 0.118,
        orange_pepper : 0.141,
        red_pepper : 0.864,
        green_pepper : 0.074,
        green_tomato : 0.064,
        pink_tomato : 0.111,
        red_tomato : 0.858
      },    
      "pink" : {
        blue_apple : 0.054,
        green_apple : 0.080,
        red_apple : 0.132,
        black_avocado : 0.088,
        green_avocado : 0.055,
        red_avocado : 0.116,
        blue_banana : 0.045,
        brown_banana : 0.040,
        yellow_banana : 0.079,
        brown_carrot : 0.135,
        orange_carrot : 0.112,
        pink_carrot : 0.498,
        green_pear : 0.048,
        orange_pear : 0.123,
        yellow_pear : 0.031,
        black_pepper : 0.040,
        orange_pepper : 0.036,
        red_pepper : 0.160,
        green_pepper : 0.025,
        green_tomato : 0.030,
        pink_tomato : 0.515,
        red_tomato : 0.198
      },   
      "green" : {
        blue_apple : 0.145,
        green_apple : 0.791,
        red_apple : 0.045,
        black_avocado : 0.032,
        green_avocado : 0.642,
        red_avocado : 0.084,
        blue_banana : 0.017,
        brown_banana : 0.058,
        yellow_banana : 0.031,
        brown_carrot : 0.068,
        orange_carrot : 0.048,
        pink_carrot : 0.046,
        green_pear : 0.640,
        orange_pear : 0.032,
        yellow_pear : 0.099,
        black_pepper : 0.101,
        orange_pepper : 0.053,
        red_pepper : 0.087,
        green_pepper : 0.929,
        green_tomato : 0.817,
        pink_tomato : 0.058,
        red_tomato : 0.084
      },    
      "blue" : {
        blue_apple : 0.896,
        green_apple : 0.069,
        red_apple : 0.079,
        black_avocado : 0.087,
        green_avocado : 0.067,
        red_avocado : 0.028,
        blue_banana : 0.917,
        brown_banana : 0.059,
        yellow_banana : 0.063,
        brown_carrot : 0.075,
        orange_carrot : 0.059,
        pink_carrot : 0.025,
        green_pear : 0.070,
        orange_pear : 0.102,
        yellow_pear : 0.053,
        black_pepper : 0.115,
        orange_pepper : 0.059,
        red_pepper : 0.018,
        green_pepper : 0.112,
        green_tomato : 0.050,
        pink_tomato : 0.075,
        red_tomato : 0.052
      },    
      "brown" : {
        blue_apple : 0.076,
        green_apple : 0.063,
        red_apple : 0.231,
        black_avocado : 0.103,
        green_avocado : 0.135,
        red_avocado : 0.368,
        blue_banana : 0.007,
        brown_banana : 0.868,
        yellow_banana : 0.108,
        brown_carrot : 0.860,
        orange_carrot : 0.141,
        pink_carrot : 0.051,
        green_pear : 0.053,
        orange_pear : 0.107,
        yellow_pear : 0.234,
        black_pepper : 0.128,
        orange_pepper : 0.285,
        red_pepper : 0.085,
        green_pepper : 0.071,
        green_tomato : 0.081,
        pink_tomato : 0.012,
        red_tomato : 0.160
      },    
      "black" : {
        blue_apple : 0.044,
        green_apple : 0.013,
        red_apple : 0.085,
        black_avocado : 0.952,
        green_avocado : 0.090,
        red_avocado : 0.066,
        blue_banana : 0.051,
        brown_banana : 0.204,
        yellow_banana : 0.061,
        brown_carrot : 0.168,
        orange_carrot : 0.056,
        pink_carrot : 0.048,
        green_pear : 0.056,
        orange_pear : 0.056,
        yellow_pear : 0.057,
        black_pepper : 0.838,
        orange_pepper : 0.032,
        red_pepper : 0.019,
        green_pepper : 0.044,
        green_tomato : 0.043,
        pink_tomato : 0.013,
        red_tomato : 0.025
      },
 "black_avocado" : {
blue_apple:0.0488888888888889,
 green_apple:0.06375,
 red_apple:0.022,
 black_avocado:0.9478125,
 green_avocado:0.29875,
 red_avocado:0.3746875,
 blue_banana:0.0466666666666667,
 brown_banana:0.00428571428571429,
 yellow_banana:0.09,
 brown_carrot:0.22,
 orange_carrot:0.125555555555556,
 pink_carrot:0.0666666666666667,
 green_pear:0.175555555555556,
 orange_pear:0.155714285714286,
 yellow_pear:0.02125,
 black_pepper:0.04,
 green_pepper:0.055,
 orange_pepper:0.0166666666666667,
 red_pepper:0.07125,
 green_tomato:0.0275,
 pink_tomato:0.01,
 red_tomato:0.132,
},
"black_pepper" : {
blue_apple:0.0025,
 green_apple:0.02,
 red_apple:0.0457142857142857,
 black_avocado:0.12,
 green_avocado:0.0575,
 red_avocado:0.0266666666666667,
 blue_banana:0.06,
 brown_banana:0.01,
 yellow_banana:0.043,
 brown_carrot:0.035,
 orange_carrot:0.02,
 pink_carrot:0.0236363636363636,
 green_pear:0.0855555555555556,
 orange_pear:0.01,
 yellow_pear:0.0171428571428571,
 black_pepper:0.899791666666667,
 green_pepper:0.212826086956522,
 orange_pepper:0.217058823529412,
 red_pepper:0.235714285714286,
 green_tomato:0.00857142857142857,
 pink_tomato:0.0344444444444444,
 red_tomato:0.0614285714285714,
},
"blue_apple" : {
blue_apple:0.9046875,
 green_apple:0.2478125,
 red_apple:0.2259375,
 black_avocado:0.0385714285714286,
 green_avocado:0.0508333333333333,
 red_avocado:0.0214285714285714,
 blue_banana:0.0833333333333333,
 brown_banana:0.126363636363636,
 yellow_banana:0.0178571428571429,
 brown_carrot:0.019,
 orange_carrot:0.0271428571428571,
 pink_carrot:0.05,
 green_pear:0.0233333333333333,
 orange_pear:0.101111111111111,
 yellow_pear:0.136666666666667,
 black_pepper:0.05,
 green_pepper:0.0114285714285714,
 orange_pepper:0.0966666666666667,
 red_pepper:0.0142857142857143,
 green_tomato:0.14,
 pink_tomato:0.05,
 red_tomato:0.0133333333333333,
},
"blue_banana" : {
blue_apple:0.025,
 green_apple:0.08,
 red_apple:0.032,
 black_avocado:0.022,
 green_avocado:0.0142857142857143,
 red_avocado:0.166,
 blue_banana:0.9009375,
 brown_banana:0.17796875,
 yellow_banana:0.2115625,
 brown_carrot:0.0183333333333333,
 orange_carrot:0.04375,
 pink_carrot:0.07,
 green_pear:0.032,
 orange_pear:0.0377777777777778,
 yellow_pear:0.151666666666667,
 black_pepper:0.0192307692307692,
 green_pepper:0.195,
 orange_pepper:0.002,
 red_pepper:0.1225,
 green_tomato:0.108333333333333,
 pink_tomato:0.06375,
 red_tomato:0.0290909090909091,
},
"brown_banana" : {
blue_apple:0.038,
 green_apple:0.0525,
 red_apple:0.425,
 black_avocado:0.0245454545454545,
 green_avocado:0.0225,
 red_avocado:0.06,
 blue_banana:0.180625,
 brown_banana:0.88328125,
 yellow_banana:0.2928125,
 brown_carrot:0.0185714285714286,
 orange_carrot:0.01,
 pink_carrot:0.0283333333333333,
 green_pear:0.0309090909090909,
 orange_pear:0.1925,
 yellow_pear:0.145,
 black_pepper:0.0183333333333333,
 green_pepper:0.052,
 orange_pepper:0.1,
 red_pepper:0.0366666666666667,
 green_tomato:0.015,
 pink_tomato:0.00333333333333333,
 red_tomato:0.151428571428571,
},
"brown_carrot" : {
blue_apple:0.02,
 green_apple:0.155,
 red_apple:0.05,
 black_avocado:0.03,
 green_avocado:0.01,
 red_avocado:0.165714285714286,
 blue_banana:0.0533333333333333,
 brown_banana:0.0733333333333333,
 yellow_banana:0.0975,
 brown_carrot:0.87765625,
 orange_carrot:0.31484375,
 pink_carrot:0.18015625,
 green_pear:0.0288888888888889,
 orange_pear:0.14,
 yellow_pear:0.0433333333333333,
 black_pepper:0.05875,
 green_pepper:0.012,
 orange_pepper:0.0344444444444444,
 red_pepper:0.153333333333333,
 green_tomato:0.0257142857142857,
 pink_tomato:0.1375,
 red_tomato:0.0342857142857143,
},
"green_apple" : {
blue_apple:0.19359375,
 green_apple:0.948125,
 red_apple:0.3078125,
 black_avocado:0.0275,
 green_avocado:0.114,
 red_avocado:0.0371428571428571,
 blue_banana:0.0325,
 brown_banana:0.0116666666666667,
 yellow_banana:0.112,
 brown_carrot:0.0125,
 orange_carrot:0.166,
 pink_carrot:0.03,
 green_pear:0.321428571428571,
 orange_pear:0.028,
 yellow_pear:0.0888888888888889,
 black_pepper:0.00875,
 green_pepper:0.158333333333333,
 orange_pepper:0.015,
 red_pepper:0.0433333333333333,
 green_tomato:0.335714285714286,
 pink_tomato:0.07,
 red_tomato:0.248333333333333,
},
"green_avocado" : {
blue_apple:0.03125,
 green_apple:0.103333333333333,
 red_apple:0.0175,
 black_avocado:0.3696875,
 green_avocado:0.95953125,
 red_avocado:0.2828125,
 blue_banana:0.0242857142857143,
 brown_banana:0.0266666666666667,
 yellow_banana:0.0133333333333333,
 brown_carrot:0.0166666666666667,
 orange_carrot:0.02,
 pink_carrot:0.0133333333333333,
 green_pear:0.101428571428571,
 orange_pear:0.0225,
 yellow_pear:0.226,
 black_pepper:0.038,
 green_pepper:0.292857142857143,
 orange_pepper:0.0855555555555556,
 red_pepper:0.04,
 green_tomato:0.107142857142857,
 pink_tomato:0.03,
 red_tomato:0.0325,
},
"green_pear" : {
blue_apple:0.0285714285714286,
 green_apple:0.06,
 red_apple:0.068,
 black_avocado:0.183333333333333,
 green_avocado:0.0375,
 red_avocado:0.0333333333333333,
 blue_banana:0.0414285714285714,
 brown_banana:0.0133333333333333,
 yellow_banana:0.0728571428571429,
 brown_carrot:0.0272727272727273,
 orange_carrot:0.03,
 pink_carrot:0.0516666666666667,
 green_pear:0.94171875,
 orange_pear:0.25734375,
 yellow_pear:0.45953125,
 black_pepper:0.075,
 green_pepper:0.41,
 orange_pepper:0.093,
 red_pepper:0.08,
 green_tomato:0.164285714285714,
 pink_tomato:0.00875,
 red_tomato:0.145555555555556,
},
"green_pepper" : {
blue_apple:0.088,
 green_apple:0.202857142857143,
 red_apple:0.03375,
 black_avocado:0.045,
 green_avocado:0.0566666666666667,
 red_avocado:0.155,
 blue_banana:0.0225,
 brown_banana:0,
 yellow_banana:0.06,
 brown_carrot:0.01,
 orange_carrot:0.02,
 pink_carrot:0.08,
 green_pear:0.108,
 orange_pear:0.0455555555555556,
 yellow_pear:0.04625,
 black_pepper:0.26188679245283,
 green_pepper:0.966923076923077,
 orange_pepper:0.266875,
 red_pepper:0.264489795918367,
 green_tomato:0.23375,
 pink_tomato:0.065,
 red_tomato:0.036,
},
"green_tomato" : {
blue_apple:0.04,
 green_apple:0.165714285714286,
 red_apple:0.024,
 black_avocado:0.005,
 green_avocado:0.045,
 red_avocado:0.07,
 blue_banana:0.026,
 brown_banana:0.05,
 yellow_banana:0.015,
 brown_carrot:0.03375,
 orange_carrot:0.0233333333333333,
 pink_carrot:0.00857142857142857,
 green_pear:0.0414285714285714,
 orange_pear:0.02,
 yellow_pear:0.0344444444444444,
 black_pepper:0.0276923076923077,
 green_pepper:0.241666666666667,
 orange_pepper:0.055,
 red_pepper:0,
 green_tomato:0.9496875,
 pink_tomato:0.1846875,
 red_tomato:0.2775,
},
"orange_carrot" : {
blue_apple:0.025,
 green_apple:0.005,
 red_apple:0.185,
 black_avocado:0.02125,
 green_avocado:0.00833333333333333,
 red_avocado:0.06,
 blue_banana:0.022,
 brown_banana:0.0177777777777778,
 yellow_banana:0.04875,
 brown_carrot:0.264375,
 orange_carrot:0.9578125,
 pink_carrot:0.18609375,
 green_pear:0.0116666666666667,
 orange_pear:0.104,
 yellow_pear:0.0728571428571429,
 black_pepper:0.0236363636363636,
 green_pepper:0.04,
 orange_pepper:0.1825,
 red_pepper:0.091,
 green_tomato:0.0166666666666667,
 pink_tomato:0.02875,
 red_tomato:0.166666666666667,
},
"orange_pear" : {
blue_apple:0.035,
 green_apple:0.13,
 red_apple:0.054,
 black_avocado:0.015,
 green_avocado:0.0075,
 red_avocado:0.149090909090909,
 blue_banana:0.0166666666666667,
 brown_banana:0.0385714285714286,
 yellow_banana:0.00571428571428571,
 brown_carrot:0.07,
 orange_carrot:0.36,
 pink_carrot:0.07,
 green_pear:0.30875,
 orange_pear:0.79140625,
 yellow_pear:0.515625,
 black_pepper:0.042,
 green_pepper:0.0544444444444444,
 orange_pepper:0.325,
 red_pepper:0.0546153846153846,
 green_tomato:0.0383333333333333,
 pink_tomato:0.055,
 red_tomato:0.0442857142857143,
},
"orange_pepper" : {
blue_apple:0.03,
 green_apple:0.058,
 red_apple:0.045,
 black_avocado:0.01,
 green_avocado:0.11,
 red_avocado:0.0454545454545455,
 blue_banana:0.0488888888888889,
 brown_banana:0.085,
 yellow_banana:0.01875,
 brown_carrot:0.102,
 orange_carrot:0.0928571428571429,
 pink_carrot:0.00727272727272727,
 green_pear:0.045,
 orange_pear:0.11,
 yellow_pear:0.168333333333333,
 black_pepper:0.143191489361702,
 green_pepper:0.256530612244898,
 orange_pepper:0.920217391304348,
 red_pepper:0.363478260869565,
 green_tomato:0.104545454545455,
 pink_tomato:0.0655555555555556,
 red_tomato:0.163333333333333,
},
"pink_carrot" : {
blue_apple:0.015,
 green_apple:0.0528571428571429,
 red_apple:0.05375,
 black_avocado:0.032,
 green_avocado:0.0918181818181818,
 red_avocado:0.022,
 blue_banana:0.02,
 brown_banana:0.0571428571428571,
 yellow_banana:0.0075,
 brown_carrot:0.198125,
 orange_carrot:0.2434375,
 pink_carrot:0.44921875,
 green_pear:0.03,
 orange_pear:0.018,
 yellow_pear:0.024,
 black_pepper:0.01,
 green_pepper:0.03,
 orange_pepper:0.0442857142857143,
 red_pepper:0,
 green_tomato:0.005,
 pink_tomato:0.128,
 red_tomato:0.0322222222222222,
},
"pink_tomato" : {
blue_apple:0.0858333333333333,
 green_apple:0.02875,
 red_apple:0.0322222222222222,
 black_avocado:0.00666666666666667,
 green_avocado:0.0591666666666667,
 red_avocado:0.06,
 blue_banana:0.051,
 brown_banana:0.0185714285714286,
 yellow_banana:0.0144444444444444,
 brown_carrot:0.03,
 orange_carrot:0.0118181818181818,
 pink_carrot:0.0711111111111111,
 green_pear:0,
 orange_pear:0.05,
 yellow_pear:0.01,
 black_pepper:0.028,
 green_pepper:0.00285714285714286,
 orange_pepper:0.049,
 red_pepper:0.036,
 green_tomato:0.20359375,
 pink_tomato:0.5753125,
 red_tomato:0.33171875,
},
"red_apple" : {
blue_apple:0.17171875,
 green_apple:0.2571875,
 red_apple:0.98046875,
 black_avocado:0.02,
 green_avocado:0.06,
 red_avocado:0.15,
 blue_banana:0.025,
 brown_banana:0.0125,
 yellow_banana:0.055,
 brown_carrot:0.00285714285714286,
 orange_carrot:0.04625,
 pink_carrot:0.034,
 green_pear:0.153333333333333,
 orange_pear:0.133,
 yellow_pear:0.0928571428571429,
 black_pepper:0.076,
 green_pepper:0.012,
 orange_pepper:0.01625,
 red_pepper:0.09,
 green_tomato:0.095,
 pink_tomato:0.0366666666666667,
 red_tomato:0.0975,
},
"red_avocado" : {
blue_apple:0.008,
 green_apple:0.02875,
 red_apple:0.254,
 black_avocado:0.216875,
 green_avocado:0.25421875,
 red_avocado:0.85953125,
 blue_banana:0.0325,
 brown_banana:0.02,
 yellow_banana:0.00166666666666667,
 brown_carrot:0.0190909090909091,
 orange_carrot:0.066,
 pink_carrot:0.0516666666666667,
 green_pear:0.00428571428571429,
 orange_pear:0.1225,
 yellow_pear:0.0211111111111111,
 black_pepper:0.0966666666666667,
 green_pepper:0.0425,
 orange_pepper:0.02,
 red_pepper:0.0166666666666667,
 green_tomato:0.0883333333333333,
 pink_tomato:0.113333333333333,
 red_tomato:0.298,
},
"red_pepper" : {
blue_apple:0.015,
 green_apple:0.044,
 red_apple:0.05,
 black_avocado:0.134285714285714,
 green_avocado:0.115,
 red_avocado:0.29,
 blue_banana:0.005,
 brown_banana:0.01,
 yellow_banana:0.102727272727273,
 brown_carrot:0.0225,
 orange_carrot:0.014,
 pink_carrot:0.02,
 green_pear:0.085,
 orange_pear:0.0366666666666667,
 yellow_pear:0.004,
 black_pepper:0.225909090909091,
 green_pepper:0.282,
 orange_pepper:0.380212765957447,
 red_pepper:0.969375,
 green_tomato:0.018,
 pink_tomato:0.041,
 red_tomato:0.11,
},
"red_tomato" : {
blue_apple:0.018,
 green_apple:0.158,
 red_apple:0.0385714285714286,
 black_avocado:0.014,
 green_avocado:0.04,
 red_avocado:0.216,
 blue_banana:0.018,
 brown_banana:0.05625,
 yellow_banana:0.25,
 brown_carrot:0.106666666666667,
 orange_carrot:0.285,
 pink_carrot:0.028,
 green_pear:0.495,
 orange_pear:0.0790909090909091,
 yellow_pear:0.0575,
 black_pepper:0.0418181818181818,
 green_pepper:0.179,
 orange_pepper:0.137272727272727,
 red_pepper:0.235,
 green_tomato:0.26859375,
 pink_tomato:0.2490625,
 red_tomato:0.96921875,
},
"yellow_banana" : {
blue_apple:0.08,
 green_apple:0.0211111111111111,
 red_apple:0.0883333333333333,
 black_avocado:0.0990909090909091,
 green_avocado:0.0742857142857143,
 red_avocado:0,
 blue_banana:0.16578125,
 brown_banana:0.32984375,
 yellow_banana:0.97984375,
 brown_carrot:0.0075,
 orange_carrot:0.09,
 pink_carrot:0.0171428571428571,
 green_pear:0.04875,
 orange_pear:0.0933333333333333,
 yellow_pear:0.0333333333333333,
 black_pepper:0.0575,
 green_pepper:0.016,
 orange_pepper:0.116,
 red_pepper:0.01,
 green_tomato:0.015,
 pink_tomato:0.0142857142857143,
 red_tomato:0.0225,
},
"yellow_pear" : {
blue_apple:0.058,
 green_apple:0.21,
 red_apple:0.142857142857143,
 black_avocado:0.15125,
 green_avocado:0.0142857142857143,
 red_avocado:0.08,
 blue_banana:0.015,
 brown_banana:0.06875,
 yellow_banana:0.3125,
 brown_carrot:0.112857142857143,
 orange_carrot:0.125454545454545,
 pink_carrot:0.065,
 green_pear:0.58828125,
 orange_pear:0.32703125,
 yellow_pear:0.936875,
 black_pepper:0.062,
 green_pepper:0.161666666666667,
 orange_pepper:0.131428571428571,
 red_pepper:0.29,
 green_tomato:0.10125,
 pink_tomato:0.065,
 red_tomato:0.042,
} ,
    };

      var typicality = tailoredtypicalities[utt][object.join("_")];
      if (typeof typicality != 'undefined') {
        // console.log(typicality);
        return typicality;
      } else {
        // console.log("reassigned");
        return 0;
    }
    
  };
  
var OverinformativeModel = function(params, context) {

    // console.log(context);
  /*var getNoise = function(utt) {
    var splited = utt.split("_");
    if (splited.length == 2) {
      return 0.1
    } else {
      return _.contains(["color","othercolor","yellow", "blue"], splited[0]) ? 0.5 : 0;
    }
  }*/

  var getUtteranceCost = function(utt) {
    var splited = utt.split("_");
    if (splited.length == 2) {
      // conditioning cost on typicality
      // return _.contains(["blue"], splited[0]) ? params.cost_type + 0.2 : params.cost_color + params.cost_type;
      return params.cost_color + params.cost_type;
    } else {
      return _.contains(["yellow","orange","red","pink","green","blue","brown","black"], splited[0]) ? params.cost_color + params.color_only_cost : params.cost_type;
    }
  };

  var uttFitness = function(utt, object) {
    var typfit = getTailoredTypicalityUnlogged(utt,object); 
    // console.log(typfit);
    return typfit; 
  };

  var literalListener = cache(function(utt){
    return Infer({method:'enumerate'},function(){
      var object = uniformDraw(context);
      // console.log(object);
      // console.log(utt);
      // that's awesome
      factor(uttFitness(utt,object)); 
      return object;
    });
  });

  // what does cache do?
  var speaker = cache(function(target) {
    // list all possible utterances in context
    var possibleutts = getUtterancesOneFeature(context);
    return Infer({method:'enumerate'},function(){
      var utt = uniformDraw(possibleutts);
      var literalListenerERP = literalListener(utt);
      var uttCost = getUtteranceCost(utt);
      // console.log(uttCost);
      // var noise = getNoise(utt);
      var score = params.alpha * literalListenerERP.score(target) - params.lengthWeight * uttCost;
      // console.log("score: ");
      // console.log(score);
      factor(score); 
      return utt;
    });
  });

  var runModel = function(speakerModel, target) { 
    var speakerERP = speakerModel(target);
    return Infer({method:'enumerate'},function(){
      var utt = sample(speakerERP);
      return utt;
    });
  };

  var runListener = function(listenerModel, utterance) { 
    var listenerERP = listenerModel(utterance);
    return Infer({method:'enumerate'},function(){
      var obj = sample(listenerERP);
      return obj;
    });
  };    

  return {
    runModel : runModel,
    speaker : speaker,
    listener: literalListener,
    runListener : runListener
  };
};
